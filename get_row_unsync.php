<?phpheader("Content-Type: application/json");$server = $_GET["server"];$table = $_GET["table"];$id_field = $_GET["id_field"];$response = array();$synced_ids = array();$count_success = 0; if($server == 'local'){	$rows_unsync = array();	include("conexi.php");	include("conexi_remote.php");	$link_local = Conectarse();	$link_remote = conectar_remote();	$q_unsync ="SELECT * FROM $table WHERE sync = ''  OR sync = '0' OR ISNULL(sync) ";	$result = mysqli_query($link_local, $q_unsync) or die("Error en: $q_unsync".mysqli_error($link_local));			while($row = mysqli_fetch_assoc($result)){				$rows_unsync[] = $row;	}		$response["query"] = $q_unsync;	$response["cant_ordenes_unsync"] = mysqli_num_rows($result);		//$response["rows_unsync"] = $rows_unsync;			//Inserta las nuevas filas		foreach($rows_unsync as $this_row ){			$str_pairs = "";						foreach($this_row as $key=>$value){				$str_pairs.= $key . " = '" . $value. "',";							}			$str_pairs  = trim($str_pairs, ",");						$insert_row_unsync="INSERT IGNORE INTO $table SET $str_pairs ";			$response["query_row_unsync"]= $insert_row_unsync;			$result = mysqli_query($link_remote,$insert_row_unsync);			if(!$result){								$response["query_remote"]= "$insert_row_unsync ";				$response["query_status"]= "Error ";				$response["query_mensaje"] = mysqli_error($link_remote);			}			else{				$count_success++;				$synced_ids[]  = $this_row["$id_field"];				$response["ordenes_subidas"] = $count_success;							}		}					//actualiza filas correcatamentes sincronizadas						$count_updated = 0;	foreach( $synced_ids as $id_value){				$update_synced="UPDATE $table SET sync = 1 WHERE $id_field = '$id_value' ";				$result = mysqli_query($link_local, $update_synced);		if(!$result){						$response["query_status"]= "Error ";			$response["query_mensaje"] = "Error en: $update_synced".mysqli_error($link_local);		}		else{			$count_updated++;			$response["ordenes_actualizadas"] = $count_updated;		}	}}else{		include("conex_remote.php");		$db_conex =  Conectarse();	$response["db_conex"] = json_decode($db_conex);		$obj_db_conex = $response["db_conex"];	//var_dump($response);		if($obj_db_conex ->status == "ok"){		$q_cant_ordenes="SELECT COUNT(id_orden) AS cant_ordenes FROM ordenes ";		$result = mysql_query($q_cant_ordenes);		if(!$result){						$response["query_status"]["remote"]= "Error ";			$response["query_mensaje"]["remote"] = "Error en: $q_cant_ordenes".mysql_error();		}		else{						$row = mysql_fetch_array($result);			$response["cant_ordenes"] = $row["cant_ordenes"];			$response["last_sync"] = date("d/m/Y H:i:s");		}		} 	}		echo json_encode($response);?>				