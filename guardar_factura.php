<?php	if($_POST["guardar"]){		$folio = $_POST["txt_folio"];		$fecha = $_POST["txt_fecha"];				$cliente = mb_strtoupper($_POST["txt_cliente"], 'UTF-8');		$alias = mb_strtoupper($_POST["txt_cliente"], 'UTF-8');		$rfc = strtoupper($_POST["txt_rfc"]);		$domicilio = mb_strtoupper($_POST["txt_domicilio"], 'UTF-8'); 		$ciudad = mb_strtoupper($_POST["txt_ciudad"], 'UTF-8'); 		$cp = $_POST["txt_cp"];		$tel = $_POST["txt_tel"];		$mail = $_POST["txt_mail"];				$cantidades = $_POST["txt_cantidad"];		$pu = $_POST["txt_unitario"];		$productos = $_POST["txt_producto"];		$importes = $_POST["txt_importe"];				$subtotal = $_POST["txt_sub"];		$iva = $_POST["txt_iva"];		$total = $_POST["txt_total"];		$total_letra = $_POST["txt_total_letra"];				$q_cliente = "SELECT * FROM Clientes WHERE Cliente_Nombre = '$cliente'";				$result_cliente = mysql_query($q_cliente,$link) or die("Error al buscar cliente: ".mysql_error());				if(mysql_num_rows($result_cliente)==0){ // Si el Cliente no existe Agregarlo			$insert_cliente ="INSERT INTO Clientes(Alias, Cliente_Nombre, RFC, Domicilio, Ciudad, CP, Tel, Correo) 			VALUES('$alias', '$cliente', '$rfc', '$domicilio', '$ciudad', '$cp', '$tel', '$mail' )";						mysql_query($insert_cliente, $link) or die('Error al guardar datos del cliente: '.mysql_error());			 		}		else{ //Si el Cliente ya existe Actualizarlo			$update_cliente="UPDATE Clientes				SET Cliente_Nombre='$cliente',				Alias='$alias', RFC='$rfc', 				Domicilio = '$domicilio', Tel = '$tel',				Correo = '$mail', CP = '$cp'				WHERE Cliente_Nombre='$cliente'";						mysql_query($update_cliente)			or die('Error al actualizar datos del cliente: Query'.$update_cliente. mysql_error());	 					}				$q_factura = "SELECT * FROM Facturas WHERE IdFactura = '$folio'";				$result_factura = mysql_query($q_factura,$link) or die("Error al buscar factura: ".mysql_error());				if(mysql_num_rows($result_factura)==0){			$insert_factura="INSERT INTO Facturas(IdFactura, Fecha, RFC, Cliente_Nombre, Subtotal, IVA, Total, Total_Letra, Estatus_Factura)			VALUES('$folio', str_to_date('$fecha', '%d/%m/%Y'), '$rfc', '$cliente', '$subtotal', '$iva', '$total', '$total_letra', 'ACTIVA')";							mysql_query($insert_factura) or die('Error insertando factura: '.mysql_error());						foreach($cantidades as $key => $value){				if($value){					$insert_productos ="INSERT INTO Productos(Producto, Precio) 					VALUES('$productos[$key]', '$pu[$key]')";										$insert_detalle ="INSERT INTO Detalle_Factura(IdFactura, IdProducto, Cantidad, Producto, PU ,Importe)					VALUES('$folio', LAST_INSERT_ID(), '$value', '$productos[$key]', '$pu[$key]', '$importes[$key]')";										mysql_query($insert_productos) or die('Error insertando productos: '.mysql_error());					mysql_query($insert_detalle) or die('Error insertando detalle: '.mysql_error());				}			}		}	}?>